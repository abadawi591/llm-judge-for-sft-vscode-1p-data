Checking Azure authentication...
INFO:azure.identity._credentials.environment:No environment configuration found.
INFO:azure.identity._credentials.managed_identity:ManagedIdentityCredential will use IMDS
INFO:azure.core.pipeline.policies.http_logging_policy:Request URL: 'http://169.254.169.254/metadata/identity/oauth2/token?api-version=REDACTED&resource=REDACTED'
Request method: 'GET'
Request headers:
    'User-Agent': 'azsdk-python-identity/1.25.1 Python/3.13.2 (Linux-6.6.87.2-microsoft-standard-WSL2-x86_64-with-glibc2.35)'
No body was attached to the request
INFO:azure.identity._credentials.chained:DefaultAzureCredential acquired a token from AzureCliCredential
Azure authentication OK
======================================================================
RUNNING PRODUCTION MODE (~120k records, 60 day window)
======================================================================
Splits to export: ['train']

Reading query from: /home/abadawix/coreai/llm_judge/telemetry-main/kusto_scripts/data_prep/raw_data_curation_databricks/queries/sft_100k_production_with_splits.kql

Connecting to Kusto...
INFO:azure.identity._credentials.environment:No environment configuration found.
INFO:azure.identity._credentials.managed_identity:ManagedIdentityCredential will use IMDS
Connecting to Blob Storage...
INFO:azure.identity._credentials.environment:No environment configuration found.
INFO:azure.identity._credentials.managed_identity:ManagedIdentityCredential will use IMDS

======================================================================
CHUNKED AGGREGATION MODE
======================================================================
Method: HASH-BASED CHUNKING (Recommended)
  âœ… Guarantees: Each conversation fully in ONE chunk
  âœ… Guarantees: Conversation completeness preserved
Strategy: Gather ALL candidates via hash chunks, then stratified sample in Python

Reading hash-chunked query from: /home/abadawix/coreai/llm_judge/telemetry-main/kusto_scripts/data_prep/raw_data_curation_databricks/queries/sft_candidates_hash_chunked.kql

ðŸ”€ HASH-BASED CHUNKING: Splitting by hash(conversationId) % 20
   âœ… Guarantees: Each conversation fully in ONE chunk
   âœ… Guarantees: Conversation completeness preserved
Processing hash chunks:   0%|          | 0/20 [00:00<?, ?chunk/s]Executing Kusto query (7490 chars)...
â±ï¸  Query running... 0s elapsedINFO:azure.core.pipeline.policies.http_logging_policy:Request URL: 'http://169.254.169.254/metadata/identity/oauth2/token?api-version=REDACTED&resource=REDACTED'
Request method: 'GET'
Request headers:
    'User-Agent': 'azsdk-python-identity/1.25.1 Python/3.13.2 (Linux-6.6.87.2-microsoft-standard-WSL2-x86_64-with-glibc2.35)'
No body was attached to the request
INFO:azure.identity._credentials.chained:DefaultAzureCredential acquired a token from AzureCliCredential
â±ï¸  Query running... 10s elapsedâ±ï¸  Query running... 20s elapsedâ±ï¸  Query running... 30s elapsedâ±ï¸  Query running... 40s elapsedâ±ï¸  Query running... 50s elapsedâ±ï¸  Query running... 1m 0s elapsedâ±ï¸  Query running... 1m 10s elapsedâ±ï¸  Query running... 1m 20s elapsedâ±ï¸  Query running... 1m 30s elapsedâ±ï¸  Query running... 1m 40s elapsedâ±ï¸  Query running... 1m 50s elapsedâ±ï¸  Query running... 2m 0s elapsedâ±ï¸  Query running... 2m 10s elapsedâ±ï¸  Query running... 2m 20s elapsedâ±ï¸  Query running... 2m 30s elapsedâ±ï¸  Query running... 2m 40s elapsedâ±ï¸  Query running... 2m 50s elapsedâ±ï¸  Query running... 3m 0s elapsedâ±ï¸  Query running... 3m 10s elapsedâ±ï¸  Query running... 3m 20s elapsedâ±ï¸  Query running... 3m 30s elapsedâ±ï¸  Query running... 3m 40s elapsedâ±ï¸  Query running... 3m 50s elapsedâ±ï¸  Query running... 4m 0s elapsedâ±ï¸  Query running... 4m 10s elapsedâ±ï¸  Query running... 4m 20s elapsedâ±ï¸  Query running... 4m 30s elapsedâ±ï¸  Query running... 4m 40s elapsedâ±ï¸  Query running... 4m 50s elapsedâ±ï¸  Query running... 5m 0s elapsedâ±ï¸  Query running... 5m 10s elapsedâ±ï¸  Query running... 5m 20s elapsedâ±ï¸  Query running... 5m 30s elapsedâ±ï¸  Query running... 5m 40s elapsedâ±ï¸  Query running... 5m 50s elapsedâ±ï¸  Query running... 6m 0s elapsedâ±ï¸  Query running... 6m 10s elapsedâ±ï¸  Query running... 6m 20s elapsedâ±ï¸  Query running... 6m 30s elapsedâ±ï¸  Query running... 6m 40s elapsedâ±ï¸  Query running... 6m 50s elapsedâ±ï¸  Query running... 7m 0s elapsedâ±ï¸  Query running... 7m 10s elapsedâ±ï¸  Query running... 7m 20s elapsedâ±ï¸  Query running... 7m 30s elapsedâ±ï¸  Query running... 7m 40s elapsedâ±ï¸  Query running... 7m 50s elapsedâ±ï¸  Query running... 8m 0s elapsedâ±ï¸  Query running... 8m 10s elapsedâ±ï¸  Query running... 8m 20s elapsedâ±ï¸  Query running... 8m 30s elapsedâ±ï¸  Query running... 8m 40s elapsedâ±ï¸  Query running... 8m 50s elapsedâ±ï¸  Query running... 9m 0s elapsedâ±ï¸  Query running... 9m 10s elapsedâ±ï¸  Query running... 9m 20s elapsedâ±ï¸  Query running... 9m 30s elapsedâ±ï¸  Query running... 9m 40s elapsedâ±ï¸  Query running... 9m 50s elapsedâ±ï¸  Query running... 10m 0s elapsed                                                  âœ… Query returned 0 records in 10m 2s
Processing hash chunks:   5%|â–Œ         | 1/20 [10:05<3:11:35, 605.02s/chunk]Executing Kusto query (7490 chars)...
â±ï¸  Query running... 0s elapsedINFO:azure.identity._internal.decorators:AzureCliCredential.get_token succeeded
INFO:azure.identity._credentials.default:DefaultAzureCredential acquired a token from AzureCliCredential
â±ï¸  Query running... 10s elapsedâ±ï¸  Query running... 20s elapsedâ±ï¸  Query running... 30s elapsedâ±ï¸  Query running... 40s elapsedâ±ï¸  Query running... 50s elapsedâ±ï¸  Query running... 1m 0s elapsedâ±ï¸  Query running... 1m 10s elapsedâ±ï¸  Query running... 1m 20s elapsedâ±ï¸  Query running... 1m 30s elapsedâ±ï¸  Query running... 1m 40s elapsedâ±ï¸  Query running... 1m 50s elapsedâ±ï¸  Query running... 2m 0s elapsedâ±ï¸  Query running... 2m 10s elapsedâ±ï¸  Query running... 2m 20s elapsedâ±ï¸  Query running... 2m 30s elapsedâ±ï¸  Query running... 2m 40s elapsedâ±ï¸  Query running... 2m 50s elapsedâ±ï¸  Query running... 3m 0s elapsedâ±ï¸  Query running... 3m 10s elapsedâ±ï¸  Query running... 3m 20s elapsedâ±ï¸  Query running... 3m 30s elapsedâ±ï¸  Query running... 3m 40s elapsedâ±ï¸  Query running... 3m 50s elapsedâ±ï¸  Query running... 4m 0s elapsedâ±ï¸  Query running... 4m 10s elapsedâ±ï¸  Query running... 4m 20s elapsedâ±ï¸  Query running... 4m 30s elapsedâ±ï¸  Query running... 4m 40s elapsedâ±ï¸  Query running... 4m 50s elapsedâ±ï¸  Query running... 5m 0s elapsedâ±ï¸  Query running... 5m 10s elapsedâ±ï¸  Query running... 5m 20s elapsedâ±ï¸  Query running... 5m 30s elapsedâ±ï¸  Query running... 5m 40s elapsedâ±ï¸  Query running... 5m 50s elapsedâ±ï¸  Query running... 6m 0s elapsedâ±ï¸  Query running... 6m 10s elapsedâ±ï¸  Query running... 6m 20s elapsedâ±ï¸  Query running... 6m 30s elapsedâ±ï¸  Query running... 6m 40s elapsedâ±ï¸  Query running... 6m 50s elapsedâ±ï¸  Query running... 7m 0s elapsedâ±ï¸  Query running... 7m 10s elapsedâ±ï¸  Query running... 7m 20s elapsedâ±ï¸  Query running... 7m 30s elapsedâ±ï¸  Query running... 7m 40s elapsedâ±ï¸  Query running... 7m 50s elapsedâ±ï¸  Query running... 8m 0s elapsedâ±ï¸  Query running... 8m 10s elapsedâ±ï¸  Query running... 8m 20s elapsedâ±ï¸  Query running... 8m 30s elapsedâ±ï¸  Query running... 8m 40s elapsedâ±ï¸  Query running... 8m 50s elapsedâ±ï¸  Query running... 9m 0s elapsedâ±ï¸  Query running... 9m 10s elapsedâ±ï¸  Query running... 9m 20s elapsedâ±ï¸  Query running... 9m 30s elapsedâ±ï¸  Query running... 9m 40s elapsedâ±ï¸  Query running... 9m 50s elapsedâ±ï¸  Query running... 10m 0s elapsedâ±ï¸  Query running... 10m 10s elapsedâ±ï¸  Query running... 10m 20s elapsedâ±ï¸  Query running... 10m 30s elapsed                                                  
âš ï¸  Query failed (attempt 1/5)
   Error: Failed to process network request for the endpoint: https://ade.loganalytics.io/subscriptions/d0c05057-7972-46ff-9bcf-3c932250155e/resourceGroups/CopilotChatEval/providers/Microsoft.OperationalInsight...
   Retrying in 30s with jitter...
Executing Kusto query (7490 chars)...
â±ï¸  Query running... 0s elapsedINFO:azure.identity._internal.decorators:AzureCliCredential.get_token succeeded
INFO:azure.identity._credentials.default:DefaultAzureCredential acquired a token from AzureCliCredential
â±ï¸  Query running... 10s elapsedâ±ï¸  Query running... 20s elapsedâ±ï¸  Query running... 30s elapsedâ±ï¸  Query running... 40s elapsedâ±ï¸  Query running... 50s elapsedâ±ï¸  Query running... 1m 0s elapsedâ±ï¸  Query running... 1m 10s elapsedâ±ï¸  Query running... 1m 20s elapsedâ±ï¸  Query running... 1m 30s elapsedâ±ï¸  Query running... 1m 40s elapsedâ±ï¸  Query running... 1m 50s elapsedâ±ï¸  Query running... 2m 0s elapsedâ±ï¸  Query running... 2m 10s elapsedâ±ï¸  Query running... 2m 20s elapsedâ±ï¸  Query running... 2m 30s elapsedâ±ï¸  Query running... 2m 40s elapsedâ±ï¸  Query running... 2m 50s elapsedâ±ï¸  Query running... 3m 0s elapsedâ±ï¸  Query running... 3m 10s elapsedâ±ï¸  Query running... 3m 20s elapsedâ±ï¸  Query running... 3m 30s elapsedâ±ï¸  Query running... 3m 40s elapsedâ±ï¸  Query running... 3m 50s elapsedâ±ï¸  Query running... 4m 0s elapsedâ±ï¸  Query running... 4m 10s elapsedâ±ï¸  Query running... 4m 20s elapsedâ±ï¸  Query running... 4m 30s elapsedâ±ï¸  Query running... 4m 40s elapsedâ±ï¸  Query running... 4m 50s elapsedâ±ï¸  Query running... 5m 0s elapsedâ±ï¸  Query running... 5m 10s elapsedâ±ï¸  Query running... 5m 20s elapsedâ±ï¸  Query running... 5m 30s elapsedâ±ï¸  Query running... 5m 40s elapsedâ±ï¸  Query running... 5m 50s elapsedâ±ï¸  Query running... 6m 0s elapsedâ±ï¸  Query running... 6m 10s elapsedâ±ï¸  Query running... 6m 20s elapsedâ±ï¸  Query running... 6m 30s elapsedâ±ï¸  Query running... 6m 40s elapsedâ±ï¸  Query running... 6m 50s elapsedâ±ï¸  Query running... 7m 0s elapsedâ±ï¸  Query running... 7m 10s elapsedâ±ï¸  Query running... 7m 20s elapsedâ±ï¸  Query running... 7m 30s elapsedâ±ï¸  Query running... 7m 40s elapsedâ±ï¸  Query running... 7m 50s elapsedâ±ï¸  Query running... 8m 0s elapsedâ±ï¸  Query running... 8m 10s elapsedâ±ï¸  Query running... 8m 20s elapsedâ±ï¸  Query running... 8m 30s elapsedâ±ï¸  Query running... 8m 40s elapsedâ±ï¸  Query running... 8m 50s elapsedâ±ï¸  Query running... 9m 0s elapsedâ±ï¸  Query running... 9m 10s elapsedâ±ï¸  Query running... 9m 20s elapsedâ±ï¸  Query running... 9m 30s elapsedâ±ï¸  Query running... 9m 40s elapsedâ±ï¸  Query running... 9m 50s elapsedâ±ï¸  Query running... 10m 0s elapsedâ±ï¸  Query running... 10m 10s elapsedâ±ï¸  Query running... 10m 20s elapsedâ±ï¸  Query running... 10m 30s elapsed                                                  
âš ï¸  Query failed (attempt 2/5)
   Error: Failed to process network request for the endpoint: https://ade.loganalytics.io/subscriptions/d0c05057-7972-46ff-9bcf-3c932250155e/resourceGroups/CopilotChatEval/providers/Microsoft.OperationalInsight...
   Retrying in 30s with jitter...
Executing Kusto query (7490 chars)...
â±ï¸  Query running... 0s elapsedINFO:azure.identity._internal.decorators:AzureCliCredential.get_token succeeded
INFO:azure.identity._credentials.default:DefaultAzureCredential acquired a token from AzureCliCredential
â±ï¸  Query running... 10s elapsedâ±ï¸  Query running... 20s elapsedâ±ï¸  Query running... 30s elapsedâ±ï¸  Query running... 40s elapsedâ±ï¸  Query running... 50s elapsedâ±ï¸  Query running... 1m 0s elapsedâ±ï¸  Query running... 1m 10s elapsedâ±ï¸  Query running... 1m 20s elapsedâ±ï¸  Query running... 1m 30s elapsedâ±ï¸  Query running... 1m 40s elapsedâ±ï¸  Query running... 1m 50s elapsedâ±ï¸  Query running... 2m 0s elapsedâ±ï¸  Query running... 2m 10s elapsedâ±ï¸  Query running... 2m 20s elapsedâ±ï¸  Query running... 2m 30s elapsedâ±ï¸  Query running... 2m 40s elapsedâ±ï¸  Query running... 2m 50s elapsedâ±ï¸  Query running... 3m 0s elapsedâ±ï¸  Query running... 3m 10s elapsedâ±ï¸  Query running... 3m 20s elapsedâ±ï¸  Query running... 3m 30s elapsedâ±ï¸  Query running... 3m 40s elapsedâ±ï¸  Query running... 3m 50s elapsedâ±ï¸  Query running... 4m 0s elapsedâ±ï¸  Query running... 4m 10s elapsedâ±ï¸  Query running... 4m 20s elapsedâ±ï¸  Query running... 4m 30s elapsedâ±ï¸  Query running... 4m 40s elapsedâ±ï¸  Query running... 4m 50s elapsedâ±ï¸  Query running... 5m 0s elapsedâ±ï¸  Query running... 5m 10s elapsedâ±ï¸  Query running... 5m 20s elapsedâ±ï¸  Query running... 5m 30s elapsedâ±ï¸  Query running... 5m 40s elapsedâ±ï¸  Query running... 5m 50s elapsedâ±ï¸  Query running... 6m 0s elapsedâ±ï¸  Query running... 6m 10s elapsedâ±ï¸  Query running... 6m 20s elapsedâ±ï¸  Query running... 6m 30s elapsedâ±ï¸  Query running... 6m 40s elapsedâ±ï¸  Query running... 6m 50s elapsedâ±ï¸  Query running... 7m 0s elapsedâ±ï¸  Query running... 7m 10s elapsedâ±ï¸  Query running... 7m 20s elapsedâ±ï¸  Query running... 7m 30s elapsedâ±ï¸  Query running... 7m 40s elapsedâ±ï¸  Query running... 7m 50s elapsedâ±ï¸  Query running... 8m 0s elapsedâ±ï¸  Query running... 8m 10s elapsedâ±ï¸  Query running... 8m 20s elapsedâ±ï¸  Query running... 8m 30s elapsedâ±ï¸  Query running... 8m 40s elapsedâ±ï¸  Query running... 8m 50s elapsedâ±ï¸  Query running... 9m 0s elapsedâ±ï¸  Query running... 9m 10s elapsedâ±ï¸  Query running... 9m 20s elapsedâ±ï¸  Query running... 9m 30s elapsedâ±ï¸  Query running... 9m 40s elapsedâ±ï¸  Query running... 9m 50s elapsedâ±ï¸  Query running... 10m 0s elapsedâ±ï¸  Query running... 10m 10s elapsedâ±ï¸  Query running... 10m 20s elapsedâ±ï¸  Query running... 10m 30s elapsed                                                  
âš ï¸  Query failed (attempt 3/5)
   Error: Failed to process network request for the endpoint: https://ade.loganalytics.io/subscriptions/d0c05057-7972-46ff-9bcf-3c932250155e/resourceGroups/CopilotChatEval/providers/Microsoft.OperationalInsight...
   Retrying in 30s with jitter...
Executing Kusto query (7490 chars)...
â±ï¸  Query running... 0s elapsedINFO:azure.identity._internal.decorators:AzureCliCredential.get_token succeeded
INFO:azure.identity._credentials.default:DefaultAzureCredential acquired a token from AzureCliCredential
â±ï¸  Query running... 10s elapsedâ±ï¸  Query running... 20s elapsedâ±ï¸  Query running... 30s elapsedâ±ï¸  Query running... 40s elapsedâ±ï¸  Query running... 50s elapsedâ±ï¸  Query running... 1m 0s elapsedâ±ï¸  Query running... 1m 10s elapsedâ±ï¸  Query running... 1m 20s elapsedâ±ï¸  Query running... 1m 30s elapsedâ±ï¸  Query running... 1m 40s elapsedâ±ï¸  Query running... 1m 50s elapsedâ±ï¸  Query running... 2m 0s elapsedâ±ï¸  Query running... 2m 10s elapsedâ±ï¸  Query running... 2m 20s elapsedâ±ï¸  Query running... 2m 30s elapsedâ±ï¸  Query running... 2m 40s elapsedâ±ï¸  Query running... 2m 50s elapsedâ±ï¸  Query running... 3m 0s elapsedâ±ï¸  Query running... 3m 10s elapsedâ±ï¸  Query running... 3m 20s elapsedâ±ï¸  Query running... 3m 30s elapsedâ±ï¸  Query running... 3m 40s elapsedâ±ï¸  Query running... 3m 50s elapsedâ±ï¸  Query running... 4m 0s elapsedâ±ï¸  Query running... 4m 10s elapsedâ±ï¸  Query running... 4m 20s elapsedâ±ï¸  Query running... 4m 30s elapsedâ±ï¸  Query running... 4m 40s elapsedâ±ï¸  Query running... 4m 50s elapsedâ±ï¸  Query running... 5m 0s elapsedâ±ï¸  Query running... 5m 10s elapsedâ±ï¸  Query running... 5m 20s elapsedâ±ï¸  Query running... 5m 30s elapsedâ±ï¸  Query running... 5m 40s elapsedâ±ï¸  Query running... 5m 50s elapsedâ±ï¸  Query running... 6m 0s elapsedâ±ï¸  Query running... 6m 10s elapsedâ±ï¸  Query running... 6m 20s elapsedâ±ï¸  Query running... 6m 30s elapsedâ±ï¸  Query running... 6m 40s elapsedâ±ï¸  Query running... 6m 50s elapsedâ±ï¸  Query running... 7m 0s elapsedâ±ï¸  Query running... 7m 10s elapsedâ±ï¸  Query running... 7m 20s elapsedâ±ï¸  Query running... 7m 30s elapsedâ±ï¸  Query running... 7m 40s elapsedâ±ï¸  Query running... 7m 50s elapsedâ±ï¸  Query running... 8m 0s elapsedâ±ï¸  Query running... 8m 10s elapsedâ±ï¸  Query running... 8m 20s elapsedâ±ï¸  Query running... 8m 30s elapsedâ±ï¸  Query running... 8m 40s elapsedâ±ï¸  Query running... 8m 50s elapsedâ±ï¸  Query running... 9m 0s elapsedâ±ï¸  Query running... 9m 10s elapsedâ±ï¸  Query running... 9m 20s elapsedâ±ï¸  Query running... 9m 30s elapsedâ±ï¸  Query running... 9m 40s elapsedâ±ï¸  Query running... 9m 50s elapsedâ±ï¸  Query running... 10m 0s elapsedâ±ï¸  Query running... 10m 10s elapsedâ±ï¸  Query running... 10m 20s elapsedâ±ï¸  Query running... 10m 30s elapsed                                                  
âš ï¸  Query failed (attempt 4/5)
   Error: Failed to process network request for the endpoint: https://ade.loganalytics.io/subscriptions/d0c05057-7972-46ff-9bcf-3c932250155e/resourceGroups/CopilotChatEval/providers/Microsoft.OperationalInsight...
   Retrying in 30s with jitter...
